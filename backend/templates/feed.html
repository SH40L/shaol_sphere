{% include 'header.html' %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/feed.css') }}">
<script defer src="{{ url_for('static', filename='js/feed.js') }}"></script>

<div class="feed-container">
  <!-- ğŸ”¹ Post Creation Box -->
  <div class="create-post-box">
    <div class="create-post-top">
      <img src="{{ current_user.profile_pic or url_for('static', filename='uploads/default.jpg') }}" alt="Profile">
      <input type="text" placeholder="Write whatâ€™s in your mind" id="openPostModal" readonly>
    </div>
    <div class="create-post-actions">
      <button id="photoBtn">ğŸ“· Photo</button>
      <button id="videoBtn">ğŸ‘¥ Video</button>
    </div>
  </div>

  <!-- ğŸ”¹ Feed Posts -->
  <div id="feed-posts">
    {% for post in posts %}
    <div class="post" data-post-id="{{ post.id }}">
      <div class="post-header">
        <img src="{{ post.user.profile_pic or url_for('static', filename='uploads/default.jpg') }}" class="post-user-img">
        <div>
          <p class="post-user-name">{{ post.user.full_name }}</p>
          <p class="post-date">{{ post.created_at.strftime('%b %d, %Y') }}</p>
        </div>
      </div>
      <p class="post-caption">{{ post.content }}</p>
      {% if post.media_url %}
      <div class="post-media">
        {% if post.media_url.endswith('.mp4') %}
          <video controls src="{{ post.media_url }}"></video>
        {% else %}
          <img src="{{ post.media_url }}">
        {% endif %}
      </div>
      {% endif %}
      <div class="post-actions">
        <button>ğŸ‘ <span>{{ post.like_count }}</span> Likes</button>
        <button>ğŸ’¬ <span>{{ post.comment_count }}</span> Comments</button>
        <button>ğŸ”— Share</button>
      </div>
      <div class="comment-section">
        {% for comment in post.comments[:1] %}
        <div class="comment">
          <img src="{{ comment.user.profile_pic or url_for('static', filename='uploads/default.jpg') }}">
          <p><strong>{{ comment.user.full_name }}</strong> {{ comment.content }}</p>
        </div>
        {% endfor %}
        <div class="comment-input">
          <img src="{{ current_user.profile_pic or url_for('static', filename='uploads/default.jpg') }}">
          <input type="text" placeholder="Comment your thought">
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- ğŸ”¹ Post Modal -->
<div id="postModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Create post</h3>
      <span id="closeModal">&times;</span>
    </div>
    <textarea id="modalCaption" placeholder="What's on your mind?"></textarea>
    <input type="file" id="mediaInput" accept="image/*,video/*" style="margin-top: 10px;">
    <img id="mediaPreview" style="display: none;">
    <video id="videoPreview" controls style="display: none; max-width: 100%; border-radius: 10px;"></video>
    <button id="submitPost">Post</button>
  </div>
</div>
